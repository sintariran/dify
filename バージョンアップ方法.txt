0. dockerを落とす
docker-compose down

1. ローカルのDifyをアップグレード
git pull upstream main
git push dify main

2. GCPにログイン
    GCPインスタンスにSSHでアクセスする方法について説明します。以下の手順に従ってください：
    1. GCPコンソールにログインします。
    2. 「Compute Engine」→「VMインスタンス」に移動します。
    3. アクセスしたいインスタンスを選択します。
    4. 「SSH」ボタンをクリックします。ブラウザ内でSSHセッションが開きます。
        ローカルマシンから直接SSHアクセスする場合：
        4.1 gcloudコマンドラインツールをインストールします。
        4.2 認証を行います：
            gcloud auth login
        4.3 プロジェクトを設定します：
            gcloud config set project premium-modem-422412-c0
        4.4 SSHでインスタンスに接続します：
            gcloud compute ssh dify-20240526 --zone asia-northeast1-b
            パスワード：いつもの

    注意：ファイアウォールルールでSSHポート（通常22番）が開いていることを確認してください。
    これらの手順でGCPインスタンスにSSHアクセスできるはずです。問題が発生した場合は、詳細をお知らせください。

3. パスの移動
cd dify/docker

4. pullリクエスト
git pull origin main

5. 仮想マシンにdocker composeのインストール
Docker Composeをダウンロードする前に格納先のフォルダを作成します。
mkdir -p $HOME/bin

Docker Composeをインストールします。今回は1.29.2を使用します。
docker run docker/compose:1.29.2 version

docker-composeを使えるようにするためにエイリアスを設定します。
echo alias docker-compose="'"'docker run --rm \
-v /var/run/docker.sock:/var/run/docker.sock \
-v "$PWD:$PWD" \
-w="$PWD" \
docker/compose:1.29.2'"'" >> ~/.bashrc

最後にターミナルを再起動するコマンドを実行します。
source ~/.bashrc

6. dockerを落とす
docker-compose down

7. dockerの再起動
docker-compose up -d

参照ページ
https://note.com/jolly_dahlia842/n/nd90ecaa669c2